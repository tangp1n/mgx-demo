# 减少澄清问题 - 让 Agent 更自主

## 问题描述

用户反馈 agent 一直在不停地澄清问题，希望 agent 更自主，减少澄清。

## 优化方案

### 优化1：系统提示词增强自主性

**文件**: `backend/src/agents/app_creator/agent.py` - `_conversation_node`

**变更**：
- 更强调**优先自主判断**：如果用户的描述足够清楚，做出合理的假设并直接继续，不要提问
- 明确**减少澄清**：只在需求存在根本性模糊（会阻碍实施）时才提问
- 限制问题数量：**最多1个问题**，而不是之前的2-3个
- 强调**快速确认**：理解核心需求后，立即总结并询问确认

**关键改动**：
```
旧：只提出最必要的澄清问题（最多2-3个问题）
新：尽可能少地提出澄清问题 - 只有在绝对必要时才提问

旧：在询问1-2个澄清问题后，总结你的理解并询问确认以继续
新：最多1个问题：如果必须提问，最多只问1个最关键的问题。不要连续提问多个问题。
```

### 优化2：澄清问题生成提示强化

**文件**: `backend/src/agents/app_creator/agent.py` - `_generate_clarifications_node`

**变更**：
- 更明确地定义**何时不应该生成问题**：样式、技术选型、功能细节、用户体验细节等，直接使用默认值
- 更强调**极端情况**才生成问题：核心功能完全不清楚、技术平台完全不确定且无法推断
- 提供具体的**不要生成问题的场景列表**，让 LLM 更清楚何时应该直接假设

**关键改动**：
```
新增明确的不应该生成问题的场景：
- 样式和设计细节（使用现代化的默认设计）
- 技术选型细节（选择最常用和合理的默认技术栈）
- 功能细节（基于常见实践做出合理假设）
- 用户体验细节（使用最佳实践作为默认）
```

### 优化3：路由逻辑（保持现状）

路由逻辑保持不变，因为：
- 当前的逻辑已经足够：当 clarifying_questions 为 None 时，会调用 generate_clarifications_node
- generate_clarifications_node 现在会通过优化后的提示，更倾向于返回 NO_QUESTIONS
- 如果返回 NO_QUESTIONS，clarifying_questions 会是空列表，然后直接进入确认

## 预期效果

优化后的 agent 应该：

1. **更自主**：
   - 对于清晰的用户描述，直接做出合理假设
   - 减少不必要的澄清问题
   - 更快地进入确认阶段

2. **更高效**：
   - 最多只问1个最关键的问题
   - 不会连续提问多个问题
   - 快速总结并确认需求

3. **更智能**：
   - 知道何时应该假设（样式、技术选型等）
   - 知道何时必须提问（核心功能不清楚等）
   - 基于常见实践做出合理默认选择

## 测试建议

1. **测试清晰的需求**：
   - 发送清晰的需求（如"网页版飞机游戏，躲避玩法，单人单机"）
   - 验证 agent 应该直接总结并确认，不提问

2. **测试模糊的需求**：
   - 发送非常模糊的需求（如"做一个游戏"）
   - 验证 agent 应该问1个关键问题（如"是什么类型的游戏？"）

3. **测试中等模糊的需求**：
   - 发送有一定细节但缺少一些信息的需求
   - 验证 agent 应该做出合理假设，而不是提问

## 相关文件

- `backend/src/agents/app_creator/agent.py`:
  - `_conversation_node`: 系统提示词（93-110行）
  - `_generate_clarifications_node`: 澄清问题生成提示（222-232行）

